name: Unified workflow
# Generated by super-secret tool using predefined template!

on:
  pull_request:
  push:

jobs:
  #gradle-verification:
  #  strategy:
  #    matrix:
  #      os: [ ubuntu-latest ]
  #
  #  name: "üõÇ Gradle Validation"
  #  runs-on: ${{ matrix.os }}
  #  steps:
  #    - name: Checkout repository
  #      uses: actions/checkout@v3
  #    - name: Move the Gradle Wrapper to repository
  #      # Unable to specify subdirectory, so we've appiled temporary fix for now.
  #      # see gradle/wrapper-validation-ation#14
  #      run: mv android/* $GITHUB_WORKSPACE
  #    - name: Validate the Gradle Wrapper
  #      uses: gradle/wrapper-validation-action@v1

  analyze:
    strategy:
      matrix:
        flutter_channel: [ stable ]
        os: [ ubuntu-latest ]

    name: "üîé Dart analyzer"
    runs-on: ${{ matrix.os }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: ${{ matrix.flutter_channel }}
          cache: true
      - name: Install Flutter dependencies
        run: flutter pub get
      - name: Generate files with Builder
        run: flutter packages pub run build_runner build --delete-conflicting-outputs
      - name: Analyze code
        uses: ValentinVignal/action-dart-analyze@v0.15
        with:
          fail-on: warning

  compile:
    strategy:
      matrix:
        java_version: [ 11 ]
        flutter_channel: [ stable ]
        os: [ ubuntu-latest ]

    name: "üõ†Ô∏è Compile Flutter App"
    runs-on: ${{ matrix.os }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Setup Java ${{ matrix.java_version }}
        uses: actions/setup-java@v3
        with:
          java-version: ${{ matrix.java_version }}
          distribution: 'zulu'
          cache: 'gradle'
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: ${{ matrix.flutter_channel }}
          cache: true
      - name: Install Flutter dependencies
        run: flutter pub get
      - name: Generate files with Builder
        run: flutter packages pub run build_runner build --delete-conflicting-outputs
      - name: Compile code
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: flutter build apk
      - name: Upload APK
        uses: actions/upload-artifact@v2
        with:
          name: app-release.apk
          path: build/app/outputs/flutter-apk/app-release.apk
          